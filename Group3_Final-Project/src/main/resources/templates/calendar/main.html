
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{/fragments/header :: header}"></head>

<!--<script src="/fullcalendar/Main.js" defer> </script>-->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.5/index.global.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" defer></script>
<!-- fullcalendar CDN -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.js' defer></script>
<!-- fullcalendar 언어 CDN  -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/locales-all.min.js' defer></script>

<!-- calendarscript 스크립트 <나중에하기>.-->
<!--<script src='/js/calenderscript.js' defer></script>-->

<body class="g-sidenav-show  bg-gray-100">
<!--   사이드 : aside -->
<aside th:replace="/fragments/aside"></aside>
<main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    <!-- body Top Navbar : bodyTop  -->
    <nav th:replace="fragments/bodyTop"></nav>
    <!-- Start Content -->
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header pb-0">
                        <h6>달력</h6>
                    </div>
                    <div class="card-body px-0 pt-0 pb-2">
                        <section>
                            <div class="row">
                                <!--    사이드바 -->

                            </div>
                            <!--    -->
                            <div class="col" style="background-color: #ffffff;">

                                <div id='calendar'>





                                    <script>


                                        document.addEventListener('DOMContentLoaded', function() {
                                            //var Draggable = FullCalendarInteraction.Draggable;
                                            var calendarEl = document.getElementById('calendar');
                                            let CalData;
                                            $.ajax({
                                                type:"GET", //겟으로 받아옴 .
                                                url:"/Calendar/getCalendarData",
                                                async: false, //비동기 -> 동기로 바꿈 . 전역변수에 값 넣어서 쓸수 있게됨
                                                success:function (res){
                                                    console.log(res);
                                                    CalData = res;
                                                }
                                            })

                                            console.log(CalData);

                                            var calendar = new FullCalendar.Calendar(calendarEl, {
                                                initialView: 'dayGridMonth',
                                                droppable: true,

                                                editable: false, // 드래그해서 수정 가능
                                                nowIndicator: true, // 현재 시간 마크
                                                dayMaxEvents: true, // 이벤트가 오버되면 높이 제한 (+ 몇 개식으로 표현)
                                                locale: 'ko', // 한국어 설정

                                                eventClick : function(info) {
                                                    let object =  info.event;
                                                   // alert(object.title); // 선택된 일정 제목
                                                    console.log(object.title);

                                                    $.ajax({
                                                        type:"POST",
                                                        url:"/Calendar/getSingleData", //해당 일정에 해당하는 데이터 객체 하나불러옴
                                                        data:{"title":object.title},
                                                        success:function (res){ //타입은 boardcommon 객체 .
                                                            if(res != ''){
                                                                $('#calModal').modal('show'); /*모달 띄우면서*/
                                                                $('#calModalTitle').html(res.boardTitle); //제목 내용 집어넣음
                                                                $('#calModalBody').html(res.boardContent);

                                                            }

                                                        }
                                                    });

                                                }
                                                ,
                                                events: CalData,
                                                googleCalendarApiKey : "AIzaSyBWS_eq3DEHprUaxOZe-mxmfl8laq2W5wg",
                                                eventSources :[
                                                    {
                                                        googleCalendarId : 'ko.south_korea.official#holiday@group.v.calendar.google.com'
                                                        , color: '#F76200'   // an option! 공휴일 표시 색
                                                        , textColor: 'white' // an option! 폰트 색
                                                    }
                                                ]

                                            });

                                            calendar.render();

                                        });

                                    </script>

                                </div>

                            </div>

                    </section>

                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- 모달 -->

    <div class="modal fade" id="calModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="calModalTitle">Modal title</h5> <!-- 일정 제목이 들어갈 부분 -->
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3"> <!-- 일정 내용이 들어갈 부분 -->
                        일정내용:
                        <textarea class="form-control" id="calModalBody"></textarea>
                    </div>

                </div>




                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>


</main>
<!-- plugin -->
<div th:replace="/fragments/plugin"></div>
</body>

</html>