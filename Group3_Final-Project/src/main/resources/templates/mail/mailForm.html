<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: header}"></head>
<!-- jquery-->
<!--<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>-->
<script src="/js/summernote/summernote-lite.js"></script>
<script src="/js/summernote/lang/summernote-ko-KR.js"></script>
<link href="/css/summernote/summernote-lite.css" rel="stylesheet">
<body class="g-sidenav-show  bg-gray-100" onunload="closePage()">
<!--   사이드 : aside -->
<!--<aside th:replace="/fragments/aside"></aside>-->
<main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    <!-- body Top Navbar : bodyTop  -->
<!--    <nav th:replace="fragments/bodyTop"></nav>-->
    <!-- Start Content -->
    <div class="container-fluid py-4">
        <!--      Left : 메일 목록 -->
        <div class="row">
<!--            <div class="col-md-4 mt-4">-->
<!--                <div class="card" style="height: 100vh;">-->
<!--                    <div class="card-header pb-0 px-3">-->
<!--                        <h6 class="mb-0">메일 목록</h6>-->
<!--                    </div>-->
<!--                    <div class="card-body pt-4 p-3">-->
<!--                        <ul class="list-group">-->
<!--                            &lt;!&ndash;                Start 예시 형식    &ndash;&gt;-->
<!--                            <li class="list-group-item border-0 d-flex p-4 mb-2 bg-gray-100 border-radius-lg"-->
<!--                                th:each="m:${mailList}">-->
<!--                                <div class="d-flex flex-column">-->
<!--                                    <h6 class="mb-3 text-sm" th:text="${m.title}">메일 제목</h6>-->
<!--                                    <span class="mb-2 text-xs">보낸 이: <span class="text-dark font-weight-bold ms-sm-2"-->
<!--                                                                           th:text="${m.getSender()}">발신자</span></span>-->
<!--                                </div>-->
<!--                                <div class="ms-auto text-end">-->
<!--                                    <a class="btn btn-link text-dark px-3 mb-0" href="javascript:" th:onclick="|window.location.href='/mail/read/${m.id}'|">Read</a>-->
<!--                                    &lt;!&ndash;                  삭제 기능 &ndash;&gt;-->
<!--                                    <a class="btn btn-link text-danger text-gradient px-3 mb-0"-->
<!--                                       href="javascript:"><i class="far fa-trash-alt me-2"></i>Delete</a>-->
<!--                                </div>-->
<!--                            </li>-->
<!--                            &lt;!&ndash;                End 예시 형식 &ndash;&gt;-->
<!--                        </ul>-->
<!--                    </div>-->

<!--                </div>-->
<!--            </div>-->
            <!-- End Left -->
            <!--        Right : 새 메일 -->
            <div class="col">
                <div class="card" style="height: 100vh;">
                    <div class="card-header pb-0">
                        <h6>새 메일</h6>
                    </div>
                    <div class="card-body px-0 pt-0 pb-2">
                        <form method="post" action="/mail/mailForm" id="mailForm">
                            <div class="table-responsive p-0">
                                <table class="table align-items-center mb-0">
                                    <thead>
                                    <tr>

                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                            <input type="submit" value="SEND" id="send-button" style="border: none;background-color: white;font-size: large;color: #1ab7ea;font-weight: bold">
                                            &nbsp;&nbsp;&nbsp;
                                            <a onclick=summernoteReset() style="font-size: large;">RESET</a>
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>
                                            <div class="d-flex px-2 py-1">
                                                <!--                      <div>-->
                                                <!--                        <img src="../assets/img/team-2.jpg" class="avatar avatar-sm me-3" alt="user1">  &lt;!&ndash; 사진 &ndash;&gt;-->
                                                <!--                      </div>-->
                                                <div class="d-flex flex-column justify-content-center">
                                                    <!--                        <h6 class="mb-0 text-sm">John Michael</h6>   &lt;!&ndash; 보낸 이  &ndash;&gt;-->
                                                    <!--                        <p class="text-xs text-secondary mb-0">john@creative-tim.com</p>  &lt;!&ndash; 이메일 &ndash;&gt;-->

                                                    <div>
                                                        <div><strong>test</strong></div>
                                                        <div>
                                                            <div>
                                                                <input placeholder="test"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="test" style="display: flex; flex-wrap: wrap">
                                                    </div>
                                                    <div>받는 이 <input class="mail-address form-control" name="receiver" style="width: 490% !important;"
                                                                     required type="email" th:if="${reply != null}" th:value="${reply}" list="all-mail-address">
                                                        <input class="mail-address form-control" name="receiver" style="width: 490% !important;"
                                                               required type="email" th:if="${reply == null}" list="all-mail-address"></div>
                                                        <datalist id="all-mail-address">
                                                            <option th:each="address : ${allMailAddress}" th:value="${address.getKey()}" th:label="${address.getValue()}"></option>
                                                        </datalist>

                                                    <div>제목 <input class="form-control" name="title" required style="width: 490% !important;"
                                                                   type="text"></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <textarea id="summernote" name="body"></textarea>

                                            <!--                                        메일 내용 -->
                                        </td>
                                    </tr>


                                    </tbody>
                                </table>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!--                End Right --->

        </div>
    </div>
</main>
<!-- plugin -->
<!--<div th:replace="/fragments/plugin"></div>-->

<!-- SUMMER NOTE -->
<script>
    $('#summernote').summernote({
        // 에디터 높이
        height: 500,
        // 에디터 한글 설정
        lang: "ko-KR",
        // 에디터에 커서 이동 (input창의 autofocus라고 생각)
        focus: true,
        toolbar: [
            // 글꼴 설정
            ['fontname', ['fontname']],
            // 글자 크기 설정
            ['fontsize', ['fontsize']],
            // 굵기, 기울임꼴, 밑줄,취소 선, 서식지우기
            ['style', ['bold', 'italic', 'underline', 'strikethrough', 'clear']],
            // 글자색
            ['color', ['forecolor', 'color']],
            // 표만들기
            ['table', ['table']],
            // 글머리 기호, 번호매기기, 문단정렬
            ['para', ['ul', 'ol', 'paragraph']],
            // 줄간격
            ['height', ['height']],
            // 코드보기, 확대해서보기, 도움말
            ['view', ['codeview', 'fullscreen', 'help']],
            // 이미지 넣기
            ['Insert', ['picture']],
            // 링크 넣기
            ['Insert', ['link']]
        ],
        // 추가한 글꼴
        fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', '맑은 고딕', '궁서', '굴림체', '굴림', '돋음체', '바탕체'],
        // 추가한 폰트사이즈
        fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '22', '24', '28', '30', '36', '50', '72'],
        callbacks : {
            onImageUpload : function(files, editor, welEditable) {
                for (let i = 0; i < files.length; i++) {
                    sendFile(files[i], this);
                }
            }
        }

    });

    function sendFile(file, el) {
        let form_data = new FormData();
        form_data.append('file', file);
        $.ajax({
            data : form_data,
            type : "POST",
            url : '/image',
            cache : false,
            contentType : false,
            enctype : 'multipart/form-data',
            processData : false,
            success : function(url) {
                $(el).summernote('insertImage', url, function($image) {
                    $image.css('width', "50%");
                });
            }
        });
    }

    // SUMMER NOTE CONTENT RESET
    function summernoteReset() {
        $('#summernote').summernote('reset');
    }

    window.onload = function () {
        let sendButton = document.getElementById('send-button');
        sendButton.addEventListener('click',()=>{
           window.opener.parent.location.reload();
        });

        let inputValue = '';
        document.querySelector('.mail-address').addEventListener('keydown', function(event) {

    if (event.keyCode === 32 || event.keyCode === 13) { // Check for space (32) or enter (13) key

        event.preventDefault(); // Prevent default behavior of space or enter key

        inputValue = event.target.value.trim(); // Update the input value variable with the current input value
        if (inputValue !== '') { // Check if input value is not empty
            const testDiv = document.querySelector('.test'); // Get the div.test element
            // const testChildDiv = document.createElement('div'); // Create a new div element for div.testChild
            // testChildDiv.className = 'testChild'; // Set the class name of the new div element
            // // testChildDiv.textContent = inputValue; // Set the text content of the new div element to the input value
            //
            // // Create div.testadd element
            // const testAddDiv = document.createElement('div');
            // testAddDiv.className = 'testadd';
            //
            // // Create three buttons
            // for (let i = 1; i <= 3; i++) {
            //     const button = document.createElement('button');
            //     button.textContent = inputValue + i;
            //     testAddDiv.appendChild(button);
            // }
            //
            // // Append testAddDiv to testChildDiv
            // testChildDiv.appendChild(testAddDiv);
            //
            // testDiv.appendChild(testChildDiv); // Append the new div element to div.test
            // 새로운 div 요소 생성
            var newDiv = document.createElement('div');
            var index = testDiv.childElementCount + 1; // 현재 .test 요소의 자식 요소 개수 + 1을 인덱스로 사용
            newDiv.id = 'out' + index; // id 속성 설정
            newDiv.innerHTML = '<div id="in' + index + '">' + inputValue + '</div><button onclick="editText(' + index + ')">수정</button><button onclick="deleteDiv(' + index + ')">삭제</button>'; // 내용 설정
            testDiv.appendChild(newDiv); // .test 요소에 새로운 div 요소 추가

            event.target.value = ''; // Clear the input value
        }
    }
});
        // document.querySelector('.mail-address').addEventListener('input', function(event) {
        //     inputValue = event.target.value; // Update the input value variable with the current input value
        // });
        //
        // document.querySelector('.testChild button:nth-child(2)').addEventListener('click', function() {
        //     let newText = '새로운 텍스트'; // 수정할 텍스트 입력
        //     document.querySelector('.testChildDiv').textContent = newText;
        // });
        //
        // // 세 번째 버튼 클릭 시 testChildDiv 삭제
        // document.querySelector('.testChild button:nth-child(3)').addEventListener('click', function() {
        //     let testChildDiv = document.querySelector('.testChildDiv');
        //     // testChildDiv.parentNode.removeChild(testChildDiv);
        //     testChildDiv.remove();
        // });

    }

    // 수정 버튼 클릭 시 호출되는 함수
    function editText(index) {
        // var input = prompt('수정할 텍스트를 입력하세요.'); // 사용자로부터 수정할 텍스트 입력 받음
        //
        // if (input !== null) { // 입력 값이 null이 아닐 경우
        //     var inDiv = document.getElementById('in' + index); // 수정할 div 요소 선택
        //     inDiv.textContent = input; // 텍스트 수정
        // }

        var inDiv = document.getElementById('in' + index); // 수정할 div 요소 선택
        var input = document.createElement('input'); // input 태그 생성
        input.type = 'text'; // input 태그의 type을 text로 설정
        input.value = inDiv.textContent; // 수정할 텍스트를 input 태그의 값으로 설정
        input.addEventListener('blur', function() {
            // input 태그가 focus를 잃었을 때(포커스가 해제되었을 때) 호출되는 이벤트 리스너
            inDiv.textContent = input.value; // input 태그의 값으로 텍스트 수정
            input.parentNode.removeChild(input); // input 태그 삭제
        });
    }

    // 삭제 버튼 클릭 시 호출되는 함수
    function deleteDiv(index) {
        var outDiv = document.getElementById('out' + index); // 삭제할 div 요소 선택
        outDiv.parentNode.removeChild(outDiv); // 부모 노드로부터 div 요소 삭제
    }

    function closePage() {
        window.opener.parent.location.reload();
    }

    // window.onload = function () {
    //     document.querySelector('.mail-address').addEventListener('keydown', () => {
    //         alert('test');
    //     });
    //
    // }
</script>


</body>
</html>








<!--<style>-->
<!--    .testChild {-->
<!--        margin-top: 10px; /* 상단 마진 설정 */-->
<!--        padding: 10px; /* 패딩 설정 */-->
<!--        background-color: #f0f0f0; /* 배경색 설정 */-->
<!--        border: 1px solid #ccc; /* 테두리 설정 */-->
<!--        border-radius: 5px; /* 둥근 테두리 설정 */-->
<!--        display: flex; /* 내부 요소를 가로로 배치 */-->
<!--        align-items: center; /* 내부 요소를 수직 가운데 정렬 */-->
<!--    }-->

<!--    .testChild .testadd {-->
<!--        margin-left: auto; /* 오른쪽 여백 설정 */-->
<!--    }-->

<!--    .testChild button {-->
<!--        margin-right: 5px; /* 버튼 간의 오른쪽 여백 설정 */-->
<!--    }-->

<!--    .testChild i {-->
<!--        margin-right: 5px; /* 아이콘 간의 오른쪽 여백 설정 */-->
<!--    }-->
<!--</style>-->

<style>
    /* .test 요소의 스타일 */
    .test {
        display: flex;
        flex-wrap: wrap;
    }
    /* .test 요소의 자식 div 요소(.out)의 스타일 */
    .out {
        margin: 5px;
        padding: 10px;
        border: 1px solid #000;
    }
    /* 수정/삭제 버튼의 스타일 */
    .out button {
        margin-top: 5px;
    }
</style>